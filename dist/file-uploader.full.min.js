/*!
 * file-uploader - jQuery file upload plugin
 * v0.9.0
 * https://github.com/jgallen23/file-uploader/
 * copyright First + Third 2015
 * MIT License
*/
!function(a,b){var c=0,d=function(a){this.obj=a};d.prototype.__init=function(a){b.extend(this,this.obj),this.id=c++,this.namespace=".fidel"+this.id,this.obj.defaults=this.obj.defaults||{},b.extend(this,this.obj.defaults,a),b("body").trigger("FidelPreInit",this),this.setElement(this.el||b("<div/>")),this.init&&this.init(),b("body").trigger("FidelPostInit",this)},d.prototype.eventSplitter=/^(\w+)\s*(.*)$/,d.prototype.setElement=function(a){this.el=a,this.getElements(),this.dataElements(),this.delegateEvents(),this.delegateActions()},d.prototype.find=function(a){return this.el.find(a)},d.prototype.proxy=function(a){return b.proxy(a,this)},d.prototype.getElements=function(){if(this.elements)for(var a in this.elements){var b=this.elements[a];this[b]=this.find(a)}},d.prototype.dataElements=function(){var a=this;this.find("[data-element]").each(function(c,d){var e=b(d),f=e.data("element");a[f]=e})},d.prototype.delegateEvents=function(){if(this.events)for(var a in this.events){var b=this.events[a],c=a.match(this.eventSplitter),d=c[1],e=c[2],f=this.proxy(this[b]);""===e?this.el.on(d+this.namespace,f):this[e]&&"function"!=typeof this[e]?this[e].on(d+this.namespace,f):this.el.on(d+this.namespace,e,f)}},d.prototype.delegateActions=function(){var a=this;a.el.on("click"+this.namespace,"[data-action]",function(c){var d=b(this),e=d.attr("data-action");a[e]&&a[e](c,d)})},d.prototype.on=function(a,b){this.el.on(a+this.namespace,b)},d.prototype.one=function(a,b){this.el.one(a+this.namespace,b)},d.prototype.emit=function(a,b,c){var d=c?this.namespace:"";this.el.trigger(a+d,b)},d.prototype.hide=function(){if(this.views)for(var a in this.views)this.views[a].hide();this.el.hide()},d.prototype.show=function(){if(this.views)for(var a in this.views)this.views[a].show();this.el.show()},d.prototype.destroy=function(){this.el.empty(),this.emit("destroy"),this.el.unbind(this.namespace)},d.declare=function(a){var b=function(a,b){this.__init(a,b)};return b.prototype=new d(a),b},d.onPreInit=function(a){b("body").on("FidelPreInit",function(b,c){a.call(c)})},d.onPostInit=function(a){b("body").on("FidelPostInit",function(b,c){a.call(c)})},a.Fidel=d}(window,window.jQuery||window.Zepto),function(a){a.declare=function(b,c){a.fn[b]=function(){var d,e,f=Array.prototype.slice.call(arguments),g=f.shift();return e=this.each(function(){var e=a(this),h=e.data(b);if(!h){var i=Fidel.declare(c),j=a.extend({},g,{el:e});h=new i(j),e.data(b,h)}"string"==typeof g&&(d=h[g].apply(h,f))}),"undefined"!=typeof d?d:e},a.fn[b].defaults=c.defaults||{}},a.Fidel=window.Fidel}(jQuery),function(a){var b=0,c=function(b){return a('<iframe name="'+b+'" />').attr({id:b,name:b,width:0,height:0}).css("display","none").appendTo("body")};a.fn.framejax=function(d){var e=d.validate||function(){return!0};return this.each(function(){var d=a(this);if("FORM"!=d[0].tagName)throw new Error("all selectors must be form tags");var f=function(){var f="__framejax__"+b++,g=c(f);g.on("load",function(){var b=a(this).contents().find("body"),c=b.html(),f="framejax.success";d.trigger("complete",c),e(a(this))||(f="framejax.error"),d.trigger(f,[g,b]),g.remove()}),d.attr("target",f)};d.on("submit",f),d.on("framejaxSubmit",f)})}}(window.jQuery),function(a){a.declare("fileUploader",{defaults:{formId:"fileUploaderForm",action:window.location.href,method:"POST",postKey:"file",progressTemplate:'<div class="progress">Uploading...</div>',completeTemplateImage:"<img/>",completeTemplateOther:"<p>The file has been uploaded &#x2714;</p>",images:["jpg","png","bmp","gif","jpeg"],allow:[],validateFunction:null,processData:null,zIndex:2,dropZone:"this",iframeValidation:null,updateProgress:function(){},onUploadError:function(){alert("Error")},onInvalidFileType:function(){alert("Please select a file with a "+this.allow.join(", ")+" extension")},showProgress:function(){this.el.html(this.progressTemplate)},showComplete:function(b){var c=this.getExtension(b),d=this.processData?this.processData(b):b,e=a.inArray(c,this.images)>-1;d&&(e?this.el.html(this.completeTemplateImage).find("img").attr("src",d):this.el.html(this.completeTemplateOther))}},init:function(){this.supportsFileApi="undefined"!=typeof window.FileReader,this.el.css("cursor","pointer"),this.setupFramejax(),this.supportsFileApi&&this.setupFileApi()},setupFramejax:function(){var b=this;a("#"+this.formId).remove(),this.el.off("mousemove");var c=a("<form/>").attr({action:this.action,method:this.method,enctype:"multipart/form-data",id:this.formId}).appendTo("body"),d=a("<input/>").attr({name:this.postKey,type:"file"}).css({opacity:"0",cursor:"pointer",position:"absolute",zIndex:this.zIndex}).on("change",function(a){var d=a.target.value;return b.checkType(d)?(b.el.trigger("fileSelect"),b.showProgress.apply(b),void c.submit()):void b.onInvalidFileType.apply(b)}).appendTo(c);this.el.on("mousemove",function(a){var b=d.height(),c=d.width();"undefined"==typeof a.pageY&&"number"==typeof a.clientX&&document.documentElement&&(a.pageX=a.clientX+document.documentElement.scrollLeft,a.pageY=a.clientY+document.documentElement.scrollTop),d.css({top:a.pageY-b/2,left:a.pageX-(c-30)})}),d.on("mouseenter",function(){clearTimeout(d.data("timer")),d.data("hovering")||b.el.trigger("fileUploaderMouseIn"),d.data("hovering",!0)}).on("mouseleave",function(){var a=setTimeout(function(){b.el.trigger("fileUploaderMouseOut"),d.data("hovering",!1)},500);d.data("timer",a)}),c.framejax({validate:b.iframeValidation}).on("complete",function(a,c){b.showComplete.call(b,c),b.el.trigger("complete",c)}).on("framejax.error",b.onUploadError.bind(b))},checkType:function(b){return this.validateFunction?this.validateFunction.call(this,b):!this.allow.length||-1!==a.inArray(this.getExtension(b),this.allow)},setupFileApi:function(){var b=this;b.dropZone="this"===b.dropZone?b.el:a(b.dropZone),b.dropZone.bind("dragenter, dragover",function(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy",b.emit("over")}),b.dropZone.bind("dragleave",function(){b.emit("out")}),b.dropZone.bind("drop",function(a){a.stopPropagation(),a.preventDefault();var c=a.originalEvent.dataTransfer.files[0];return b.checkType(c.name)?void b.upload(c):void b.onInvalidFileType.apply(b)})},getExtension:function(a){return a.split(".").pop().toLowerCase()},upload:function(a){var b=new FormData,c=this,d=new XMLHttpRequest;b.append(this.postKey,a),c.showProgress.apply(c),d.open("POST",c.action,!0),d.upload.onprogress=c.updateProgress,d.onload=function(a){c.showComplete.call(c,this.responseText,this,a),c.el.trigger("complete",this.responseText),200!==a.currentTarget.status&&c.onUploadError.apply(c,arguments)},d.send(b)}})}(window.jQuery);